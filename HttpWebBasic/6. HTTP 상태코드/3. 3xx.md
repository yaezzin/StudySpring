# # 6-3. ```3xx```

요청을 완료하기 위해 유저 에이전트(웹 브라우저)의 추가 조치 필요

## 리다이렉션

웹 브라우저는 3xx 응답의 결과에 Location 헤더가 있으면, Location 위치로 자동 이동! → 리다이렉트

* ```영구 리다이렉션``` : 특정 리소스의 URI가 영구적으로 이동
* ```일시 리다이렉션``` : 일시적인 변경  ex) 주문 완료 후 주문 내역 화면으로 이동, PRG 패턴
* ```특수 리다이렉션``` : 결과 대신 캐시를 사용

### 상황 가정!
<img width="500" alt="스크린샷 2022-03-23 오후 10 02 02" src="https://user-images.githubusercontent.com/97823928/159705277-f2088d49-f057-47be-95f9-07bd38968d7e.png">

/event 대신 /new-event 경로를 사용한다고 가정해보자  
기존 사용자들은 /event경로를 북마크를 해놨을 수도 있고, 기존 링크는 여러 곳에 공유되어있을 수 있음  
사용자가 /event로 들어오더라도, 자동 리다이렉트를 통해 /new-event 경로로 이동시키는데,    
301 응답코드를 내고 Location 위치를 /new-event로 주면 웹브라우저가 이 경로로 변경시킴  
→ 웹브라우저가 다시 /new-event를 요청하면 서버가 new-event에 대한 응답 html을 내려줌  
→ 사용자가 옛날 url을 쳤더라도 새로운 경로의 창을 보는 것임 but 사용자 입장에서는 이 과정이 너무 빨라서 인식하지 못하는 것일뿐!  

## 📌 301, 308

```영구 리다이렉션```
* 리소스의 URI가 영구적으로 이동
* 원래의 URL을 사용하면 안됨, 검색 엔진에서도 변경을 인지할 수 있음

### 301 Moved Permanently
<img width="500" alt="스크린샷 2022-03-23 오후 10 02 11" src="https://user-images.githubusercontent.com/97823928/159705301-92a1f611-c929-4977-9c3d-366326ce524e.png">

* 301은 리다이렉트 시 **요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음** (무조건은 아님)
* POST /event 보냄 (name=hello&age=20) → 서버에서는 /event를 더이상 사용하지 않으니 301 상태코드를 반환
* → 클라이언트는 /new-event로 url을 변경하고 요청메서드는 Get으로 변경되고 메세지바디 부분이 다 사라짐
* → 이는 사용자가 POST로 등록을 하려했던 것을 다시 시작해야하는 경우라고 볼 수 있음! (new-event 페이지를 보냈기 때문임)

### 308 Permanent Redirect
301의 문제를 308로 해결해보자

<img width="500" alt="스크린샷 2022-03-23 오후 10 02 19" src="https://user-images.githubusercontent.com/97823928/159705324-959b5ca4-e77f-4a7e-a82e-bfae15085083.png">

* 301과 기능은 같으나 리다이렉트시 **요청 메서드와 본문을 유지** (처음 POST를 보내면 리다이렉트도 POST)
* 클라이언트가 서버로 POST를 사용하여 요청 → /event로 넘어옴 → 서버는 308을 반환
* → 클라이언트에서 서버로 보낼 때 POST와 메세지 본문을 유지해줌 → 데이터가 등록이 됨

## 📌 302, 307, 303

```일시적인 리다이렉션```
* 리소스의 URI가 일시적으로 변경
* 따라서 검색 엔진 등에서 URL을 변경하면 안됨!

### 302 Found
* 302은 리다이렉트 시 요청 메서드가 GET으로 변하고, 본문이 제거될 수 있음(MAY)
* 302 스펙의 원래 의도는 HTTP 메서드를 유지하는 것이었는데, 웹 브라우저들이 대부분 GET으로 바꾸어 버림
* 그래서 모호한 302를 대신하는 명확한 307과 303이 등장한 것임
* 303, 307을 권장하나 현실적으로 302를 많이 사용한다

### 307 Temporary Redirect
* 302와 기능은 같음
* 리다이렉트 시 요청 메서드와 본문 유지 (요청 메서드를 변경하면 안된다! MUST NOT!)

### 303 See Other
* 302와 기능은 같음
* 리다이렉시 요청 메서드가 GET으로 변경
* 302는 명확하지 않은데, 나는 무조건 GET으로 명확하게 보내고 싶은데! 라고 하면 303을 쓰면 됨

### ✨ PRG: Post/Redirect/Get

* 가정) POST로 주문 후에 웹 브라우저를 새로고침 함 → 새로고침은 다시 요청하는 것이므로 중복 주문이 될 수 있음!
* 이것을 해결하기 위해 PRG를 사용해보자

#### <PRG 사용 전>

<img width="500" alt="스크린샷 2022-03-23 오후 10 24 31" src="https://user-images.githubusercontent.com/97823928/159709643-0771f00f-8526-40ed-98bd-825d0bf5ddc6.png">

#### <PRG 사용 후> ✨ 그림 잘보자 ✨

<img width="500" alt="스크린샷 2022-03-23 오후 10 29 48" src="https://user-images.githubusercontent.com/97823928/159710705-cbe1229f-6f1e-4234-a1c4-0437265fd527.png">

* POST로 주문 후에 주문 결과 화면을 GET으로 리다이렉트
* 새로 고침해도 결과 화면을 GET으로 조회
* 중복 주문 대신에 결과 화면만 GET으로 다시 요청

## 📌 300, 304

```기타 리다이렉션 ```

### 300 Multiple Choices 
* 거의 안씀

### 304 Not Modified

* ```캐시``` 목적으로 사용
* 클라이언트에게 리소스가 수정되지 않았음을 알려줌
* 따라서 클라이언트는 로컬 PC에 저장된 캐시를 재사용한다.
* 304 응답은 응답에 메세지 바디를 포함하면 안된다. (로컬 캐시를 사용해야하므로)
* 조건부 GET, HEAD 요청 시 사용
